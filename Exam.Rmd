---
title: "Social and Cultural Dynamics"
author: "Alberte Baggesgaard Seeberg"
date: "2/5/2018"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```



```{r}
#Setting working directory
setwd("~/Desktop/Exam SocCult/SocCultExam")

library(dplyr)
library(tidyverse)
library(rethinking)
library(ggplot2)
library(cowplot)


Ultimatum <- do.call("rbind", lapply( list.files("~/Desktop/Exam SocCult/SocCultExam/Ultimatum",full=TRUE),
		read.csv, header=TRUE))

UG3=read.csv("ultimatumS3_p.csv", sep=";")
UG11=read.csv("ultimatum11.csv", sep=";")

Ultimatum=rbind(Ultimatum, UG3)
Ultimatum=rbind(Ultimatum, UG11)

Survey <- do.call("rbind", lapply( list.files("~/Desktop/Exam SocCult/SocCultExam/Survey",full=TRUE),
		read.csv, header=TRUE))

PublicGoods <- do.call("rbind", lapply( list.files("~/Desktop/Exam SocCult/SocCultExam/Public_Goods",full=TRUE),
		read.csv, header=TRUE))

PG4=read.csv("public_goodsS4_p.csv", sep=";")
PG5=read.csv("public_goodsS5_u.csv", sep=";")

PublicGoods=rbind(PublicGoods, PG4)

PublicGoods=rbind(PublicGoods, PG5)

Winners=data.frame(Ultimatum$participant.code, Ultimatum$player.team)

Winners$participant.code=Winners$Ultimatum.participant.code
Winners$team=Winners$Ultimatum.player.team

Winners=Winners[-2]
Winners=Winners[-1]

Winners=Winners[!duplicated(Winners$participant.code),]


PG_R1=subset(PublicGoods[PublicGoods$subsession.round_number=="1",])
PG_R2=subset(PublicGoods[PublicGoods$subsession.round_number=="2",])

PG1=merge(PG_R1, Winners, by="participant.code")
PG2=merge(PG_R2, Winners, by="participant.code")

PG1=PG1[,c(1,2,15,16,17,20,22,23,26,33)]
PG2=PG2[,c(1,2,15,16,17,20,22,23,26,33)]



```


```{r}

glimmer(player.contribution~team, PG1)

model1=map(
alist(
player.contribution ~ dnorm( mu , sigma ),
mu <- Interceptall+Intercept[session.code] +
(b_teamall+b_team[session.code])*team,
Interceptall ~ dnorm(50,20),
b_teamall ~ dnorm(0,10),
Intercept[session.code] ~ dnorm(0,10),
b_team[session.code] ~ dnorm(0,10),
sigma ~ dunif(0,50)
),
data=PG2)


precis1=precis(model1)

precis1
plot(precis1)

x=extract.samples(model1)

sum(x$b_teamall<0)/10000


model2=map(
alist(
player.contribution ~ dnorm( mu , sigma ),
mu <- Interceptall+Intercept[session.code],
Interceptall ~ dnorm(50,20),
Intercept[session.code] ~ dnorm(0,10),
sigma ~ dunif(0,50)
),
data=PG1)

precis2=precis(model2)

precis2
plot(precis2)

compare(model1,model2)

#ADOS data - need to change if used!
# To plot the model
#Team.seq <- seq( from=-10 , to=15 , by=0.1 )

#mu <- link( mVerbalIQ , data=data.frame(VerbalIQ=ScaleVIQ.seq) )
#str(mu)
# mu.mean <- apply( mu , 2 , mean )
# mu.HPDI <- apply( mu , 2 , HPDI , prob=0.89 )
# 
# sim.ados <- sim(mVerbalIQ , data=list(VerbalIQ=ScaleVIQ.seq) )
# #summarizing the distribution of the simulation
# ados.HPDI <- apply( sim.ados , 2 , HPDI , prob=0.89 )
# 
# 
# # plot raw data
# plot(ADOS ~ VerbalIQ , scaledata , col=col.alpha(rangi2,0.5) )
# # draw MAP line
# lines( ScaleVIQ.seq , mu.mean )
# # draw HPDI region for line
# shade(mu.HPDI , ScaleVIQ.seq)
# # draw PI region for simulated heights
# shade(ados.HPDI , ScaleVIQ.seq)



post=extract.samples(model1)
mu.team=post$Intercept+post$b_team
PI(mu.team)

#Models from book (applications for college)

# model3 <- map(
#     alist(
#          player.contribution ~ dbinom( nrow(PG1) , p ) ,
#          logit(p) <- a + bm*male ,
#          a ~ dnorm(0,10) ,
#          bm ~ dnorm(0,10)
# ),
#     data=d )
# model4 <- map(
#     alist(
#          admit ~ dbinom( applications , p ) ,
#          logit(p) <- a ,
#          a ~ dnorm(0,10)
# ), data=d )
# 



model2=map(
alist(
player.contribution ~ dnorm( mu , sigma ),
mu <- Intercept +
b_team*team,
Intercept ~ dnorm(0,20),
b_team ~ dnorm(0,20),
sigma ~ dcauchy(0,5)
),
data=PG2)

precis2=precis(model2)
precis2

plot(precis2)



#Histograms for round 1
simplehist(PG1$player.contribution[PG1$team=="1"], xlim=c(0,100) , xlab="Contribution")


simplehist(PG1$player.contribution[PG1$team=="2"], xlim=c(0,100) , xlab="Contribution")


#Density plots for round 1, including HPDI
plot2 = dens(PG1$player.contribution[PG1$team=="2"], xlim=c(0,100) , xlab="Contribution", show.HPDI=0.50, col="red")

plot1 = dens(PG1$player.contribution[PG1$team=="1"], xlim=c(0,100) , xlab="Contribution", show.HPDI=0.50, add=TRUE)

#Density plots for round 2, including HPDI
plot3 = dens(PG2$player.contribution[PG2$team=="2"], xlim=c(0,100) , xlab="Contribution", show.HPDI=0.50, col="red")

plot4 = dens(PG2$player.contribution[PG2$team=="1"], xlim=c(0,100) , xlab="Contribution", show.HPDI=0.50, add=TRUE)

#Round 1 PI
PI(PG1$player.contribution[PG1$team=="1"], prob=0.5)
PI(PG1$player.contribution[PG1$team=="2"], prob=0.5)

#Round 2 PI
PI(PG2$player.contribution[PG2$team=="1"], prob=0.5)
PI(PG2$player.contribution[PG2$team=="2"], prob=0.5)


PG1$round=1
PG2$round=2

alldata=rbind(PG1,PG2)

model5=map(
alist(
player.contribution ~ dnorm( mu , sigma ),
mu <- Interceptall+Intercept[session.code] +
(b_teamall+b_team[session.code])*team+
(b_roundall+b_round[session.code])*round+
(b_interactionall+b_interaction[session.code])*round*team,
Interceptall ~ dnorm(50,20),
b_teamall ~ dnorm(0,10),
Intercept[session.code] ~ dnorm(0,10),
b_team[session.code] ~ dnorm(0,10),
b_interactionall~dnorm(0,5),
b_interaction[session.code]~dnorm(0,5),
b_roundall~dnorm(0,10),
b_round[session.code]~dnorm(0,10),
sigma ~ dunif(0,50)
),
data=alldata)

precis5=precis(model5)
precis5

plot(precis5)

```


